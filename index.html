<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iTabs Popup Clip Test - Preloaded</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #1a1a2e;
        color: #eee;
        padding: 20px;
        min-height: 100vh;
    }
    
    h1 {
        color: #00d4ff;
        margin-bottom: 10px;
        font-size: 1.5rem;
    }
    
    .subtitle {
        color: #888;
        margin-bottom: 30px;
        font-size: 0.9rem;
    }
    
    /* Hidden preload container */
    .preload-container {
        position: absolute;
        left: -9999px;
        width: 1px;
        height: 1px;
        overflow: hidden;
    }
    
    .preload-container iframe {
        width: 320px;
        height: 180px;
    }
    
    /* Sections */
    .section {
        background: #16213e;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid #00d4ff;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .section-title {
        font-size: 1.1rem;
        color: #00d4ff;
        margin-bottom: 10px;
    }
    
    .watch-btn {
        background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
        color: white;
        border: none;
        padding: 12px 18px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .watch-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
    }
    
    .watch-btn:active {
        transform: scale(0.98);
    }
    
    .time-badge {
        background: #0f3460;
        color: #00d4ff;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 0.8rem;
        display: inline-block;
        margin-bottom: 10px;
    }
    
    .section-content {
        font-size: 0.95rem;
        line-height: 1.6;
        color: #ccc;
        margin-top: 10px;
    }
    
    .section-notes {
        background: #0f3460;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        font-size: 0.9rem;
        line-height: 1.5;
    }
    
    .section-notes strong {
        color: #ffd93d;
    }
    
    /* Modal Overlay */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }
    
    .modal-overlay.active {
        display: flex;
    }
    
    .modal-content {
        background: #16213e;
        border-radius: 16px;
        width: 100%;
        max-width: 700px;
        max-height: 90vh;
        overflow: hidden;
        position: relative;
        animation: modalSlideIn 0.25s ease;
    }
    
    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: scale(0.95) translateY(20px);
        }
        to {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid #0f3460;
    }
    
    .modal-title {
        color: #00d4ff;
        font-size: 1.1rem;
    }
    
    .close-btn {
        background: #0f3460;
        border: none;
        color: #fff;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
    }
    
    .close-btn:hover {
        background: #ff6b6b;
    }
    
    .modal-video {
        width: 100%;
        aspect-ratio: 16/9;
        background: #000;
    }
    
    .modal-video iframe {
        width: 100%;
        height: 100%;
        border: none;
    }
    
    .modal-controls {
        padding: 15px 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
    }
    
    .replay-btn {
        background: #00d4ff;
        color: #1a1a2e;
        border: none;
        padding: 14px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background 0.2s;
    }
    
    .replay-btn:hover {
        background: #00b8e6;
    }
    
    .modal-time {
        color: #888;
        font-size: 0.9rem;
    }
    
    /* Info box */
    .info-box {
        background: #0d2137;
        border: 1px solid #00d4ff33;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 30px;
        font-size: 0.9rem;
        line-height: 1.6;
    }
    
    .info-box h3 {
        color: #ffd93d;
        margin-bottom: 10px;
    }
    
    /* Loading indicator */
    .loading-status {
        background: #0f3460;
        padding: 10px 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 0.85rem;
        color: #888;
    }
    
    .loading-status.ready {
        color: #4ade80;
    }
</style>
```

</head>
<body>
    <h1>üé¨ iTabs Popup Clips</h1>
    <p class="subtitle">DeWalt Setup Video - Preloaded for instant playback</p>

```
<div class="loading-status" id="loadingStatus">
    ‚è≥ Preloading video clips...
</div>

<div class="info-box">
    <h3>How this works:</h3>
    <p>Videos preload in the background when the page loads. Tap <strong>"Watch Clip"</strong> to instantly play that section. Hit <strong>üîÑ Replay</strong> to watch again.</p>
</div>

<!-- Section 1 -->
<div class="section">
    <div class="section-header">
        <div>
            <div class="section-title">üìç Section 1: Introduction</div>
            <div class="time-badge">‚è±Ô∏è 0:00 - 0:30</div>
        </div>
        <button class="watch-btn" onclick="openClip(0)">
            ‚ñ∂Ô∏è Watch Clip
        </button>
    </div>
    <div class="section-content">
        <p>Overview of what this video covers and what you'll learn about setting up your DeWalt tool.</p>
    </div>
    <div class="section-notes">
        <strong>Jon's Note:</strong> Quick intro - watch once to know what's coming, then skip to the sections you need.
    </div>
</div>

<!-- Section 2 -->
<div class="section">
    <div class="section-header">
        <div>
            <div class="section-title">üîß Section 2: Unboxing & Parts</div>
            <div class="time-badge">‚è±Ô∏è 0:30 - 1:15</div>
        </div>
        <button class="watch-btn" onclick="openClip(1)">
            ‚ñ∂Ô∏è Watch Clip
        </button>
    </div>
    <div class="section-content">
        <p>What's in the box and making sure you have all the pieces before starting setup.</p>
    </div>
    <div class="section-notes">
        <strong>Jon's Note:</strong> Check your box against this - don't want to get halfway through and find something's missing.
    </div>
</div>

<!-- Section 3 -->
<div class="section">
    <div class="section-header">
        <div>
            <div class="section-title">‚öôÔ∏è Section 3: Main Setup</div>
            <div class="time-badge">‚è±Ô∏è 1:15 - 2:00</div>
        </div>
        <button class="watch-btn" onclick="openClip(2)">
            ‚ñ∂Ô∏è Watch Clip
        </button>
    </div>
    <div class="section-content">
        <p>The key setup steps - this is the important part to get right.</p>
    </div>
    <div class="section-notes">
        <strong>Jon's Note:</strong> This is the one to replay a few times. Watch the hand positions carefully.
    </div>
</div>

<!-- Hidden preload container - videos load here in background -->
<div class="preload-container" id="preloadContainer"></div>

<!-- Modal Popup -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <div class="modal-title" id="modalTitle">Section Title</div>
            <button class="close-btn" onclick="closeModal()">‚úï</button>
        </div>
        <div class="modal-video" id="modalVideo">
            <!-- Active player goes here -->
        </div>
        <div class="modal-controls">
            <button class="replay-btn" id="replayBtn" onclick="replayClip()">
                üîÑ Replay Section
            </button>
            <span class="modal-time" id="modalTime">0:00 - 0:30</span>
        </div>
    </div>
</div>

<script>
    // Clip definitions - easy to modify
    const clips = [
        {
            title: "Section 1: Introduction",
            videoId: "2kKMferguto",
            start: 0,
            end: 30,
            timeLabel: "0:00 - 0:30"
        },
        {
            title: "Section 2: Unboxing & Parts",
            videoId: "2kKMferguto",
            start: 30,
            end: 75,
            timeLabel: "0:30 - 1:15"
        },
        {
            title: "Section 3: Main Setup",
            videoId: "2kKMferguto",
            start: 75,
            end: 120,
            timeLabel: "1:15 - 2:00"
        }
    ];
    
    let players = [];
    let currentClipIndex = -1;
    let activePlayer = null;
    let apiReady = false;
    
    // Load YouTube IFrame API
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    
    // Called automatically when YouTube API is ready
    function onYouTubeIframeAPIReady() {
        apiReady = true;
        preloadAllClips();
    }
    
    // Preload all clips in hidden container
    function preloadAllClips() {
        const container = document.getElementById('preloadContainer');
        
        clips.forEach((clip, index) => {
            const div = document.createElement('div');
            div.id = `preload-${index}`;
            container.appendChild(div);
            
            players[index] = new YT.Player(`preload-${index}`, {
                height: '180',
                width: '320',
                videoId: clip.videoId,
                playerVars: {
                    'start': clip.start,
                    'end': clip.end,
                    'rel': 0,
                    'modestbranding': 1,
                    'playsinline': 1,
                    'enablejsapi': 1,
                    'origin': window.location.origin
                },
                events: {
                    'onReady': (event) => {
                        // Preload by cueing to start time
                        event.target.cueVideoById({
                            videoId: clip.videoId,
                            startSeconds: clip.start,
                            endSeconds: clip.end
                        });
                        checkAllLoaded();
                    },
                    'onStateChange': onPlayerStateChange
                }
            });
        });
    }
    
    let loadedCount = 0;
    function checkAllLoaded() {
        loadedCount++;
        if (loadedCount >= clips.length) {
            document.getElementById('loadingStatus').innerHTML = '‚úÖ All clips ready - tap to play instantly';
            document.getElementById('loadingStatus').classList.add('ready');
        }
    }
    
    // Handle video state changes (for auto-stop at end time)
    function onPlayerStateChange(event) {
        // When video ends or reaches end time
        if (event.data === YT.PlayerState.ENDED) {
            // Video finished - just pause, user can replay
        }
    }
    
    // Open clip in modal
    function openClip(index) {
        if (!apiReady || !players[index]) {
            alert('Still loading, try again in a moment');
            return;
        }
        
        currentClipIndex = index;
        const clip = clips[index];
        
        // Update modal UI
        document.getElementById('modalTitle').textContent = clip.title;
        document.getElementById('modalTime').textContent = clip.timeLabel;
        
        // Move player to modal
        const modalVideo = document.getElementById('modalVideo');
        const playerElement = players[index].getIframe();
        
        // Style for modal display
        playerElement.style.width = '100%';
        playerElement.style.height = '100%';
        playerElement.style.position = 'absolute';
        playerElement.style.left = '0';
        playerElement.style.top = '0';
        
        modalVideo.style.position = 'relative';
        modalVideo.appendChild(playerElement);
        
        // Show modal
        document.getElementById('modalOverlay').classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Seek to start and play
        players[index].seekTo(clip.start, true);
        players[index].playVideo();
        
        activePlayer = players[index];
    }
    
    // Replay current clip
    function replayClip() {
        if (currentClipIndex >= 0 && players[currentClipIndex]) {
            const clip = clips[currentClipIndex];
            players[currentClipIndex].seekTo(clip.start, true);
            players[currentClipIndex].playVideo();
        }
    }
    
    // Close modal
    function closeModal(event) {
        // If clicking overlay (not content), or close button
        if (!event || event.target.id === 'modalOverlay') {
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
            
            // Pause video
            if (activePlayer) {
                activePlayer.pauseVideo();
            }
            
            // Move player back to preload container
            if (currentClipIndex >= 0 && players[currentClipIndex]) {
                const preloadDiv = document.getElementById(`preload-${currentClipIndex}`);
                const playerElement = players[currentClipIndex].getIframe();
                if (preloadDiv && playerElement) {
                    playerElement.style.width = '320px';
                    playerElement.style.height = '180px';
                    playerElement.style.position = '';
                    preloadDiv.appendChild(playerElement);
                }
            }
            
            currentClipIndex = -1;
            activePlayer = null;
        }
    }
    
    // Close on escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeModal({ target: { id: 'modalOverlay' } });
        }
    });
</script>
```

</body>
</html>
